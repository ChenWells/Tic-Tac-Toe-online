graph TD
    A[DOMContentLoaded] --> B[綁定事件監聽器]
    B --> C[onClick: login]
    B --> D[onClick: showPage]
    B --> E[onClick: sendMessage]
    B --> F[onClick: logout]
    B --> G[onClick: leaveRoom]
    B --> H[onClick: createRoom]
    B --> I[onClick: makeMove]
    I --> makeMove[makeMove 處理玩家移動]
    makeMove --> U["socket.emit('makeMove')"]
    U --> V["socket.on('gameUpdate')"]
    V --> W[updateBoard 更新遊戲板]
    V --> X[更新玩家資訊]
    V --> Y[處理遊戲結束]
    Y --> Z[提示遊戲結果]
    Y --> AA[請求新遊戲或離開房間]
    AA --> AB["socket.emit('requestNewGame')"]
    AA --> AC["socket.emit('leaveRoom')"]
    C --> J["socket.emit('login')"]
    D --> K[隱藏所有頁面]
    D --> L[顯示指定頁面]
    E --> M["socket.emit('chatMessage')"]
    F --> N["socket.emit('logout')"]
    F --> O[清除遊戲狀態]
    O --> resetPlayerStats[resetPlayerStats 重置統計數據]
    F --> P[返回登入頁面]
    G --> Q["socket.emit('leaveRoom')"]
    G --> R[清除遊戲狀態]
    R --> resetPlayerStats[resetPlayerStats 重置統計數據]
    G --> S[返回大廳頁面]
    H --> T["socket.emit('createRoom')"]
    J --> AD["socket.on('roomList')"]
    AD --> AE[更新房間列表]
    J --> AF["socket.on('joinSuccess')"]
    AF --> AG[initializeGame 初始化遊戲]
    AG --> AH[生成井字格]
    AG --> AI[綁定點擊事件]
    AI --> AJ[onClick: makeMove]
    J --> AK["socket.on('chatMessage')"]
    AK --> AL[addChatMessage 添加聊天訊息]
    AL --> AM[顯示聊天訊息]
    J --> AN["socket.on('playerStatsUpdate')"]
    AN --> AO[updatePlayerStats 更新玩家統計數據]
    AO --> AP[更新玩家勝負記錄]

    %% 樣式定義
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef event fill:#ff7675,stroke:#d63031,stroke-width:2px;
    classDef socket fill:#74b9ff,stroke:#0984e3,stroke-width:2px;
    classDef function fill:#55efc4,stroke:#00b894,stroke-width:2px;

    %% 套用樣式
    class A,B,C,D,E,F,G,H,I,AJ event;
    class J,M,N,Q,T,U,V,AB,AC,AD,AF,AK,AN socket;
    class K,L,O,P,R,S,W,X,Y,Z,AA,AE,AG,AH,AI,AL,AM,AO,AP,makeMove function; 